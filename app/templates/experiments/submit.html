{% extends 'experiments/base.html' %}

{% block contenttitle %}
<h2><span style="color: red">CONP Portal</span> | Experiments Form</h2>
{% endblock %}

{% block appcontent %}
  <div>
    {% for message in get_flashed_messages() %}
      <div class="alert alert-warning">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        {{ message }}
      </div>
    {% endfor %}
    {% for field_name, list_errors in form.errors.items() %}
      <div class="alert alert-warning">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        Errors for field '{{ field_name }}': {{ list_errors }}
      </div>
    {% endfor %}
  </div>
  <form novalidate method="post">
    {{ form.hidden_tag() }}
    {% for field in form %}
      {% if field.type == 'SubmitField' %}
        {{ field(class='btn btn-primary') }}
      {% elif field.type != 'CSRFTokenField' %}
        <div class="{{ 'form-group required' if field.flags.required else 'form-group' }}">
          {{ field.label(class='m-0') }}
          <small class="form-text text-muted mt-0 mb-1">
            {{ field.description }}
          </small>
          {% if field.type in ['StringField', 'TextAreaField', 'FloatField', 'SelectField', 'FileField'] %}
            {{ field(class='form-control') }}
          {% elif field.type == 'FieldList' %}
            <ul class="p-0" id="{{ field.name }}" style="list-style: none;">
              {% for entry in field.entries %}
                <li>
                  {{ entry(class='form-control') }}
                </li>
              {% endfor %}
            </ul>
            <div class="btn-group btn-group-sm" role="group">
              <button class="btn btn-outline-dark form-btn" type="button" onclick="experiments.addFieldListEntry('{{ field.name }}')">
                Add Another
              </button>
              <button class="btn btn-outline-dark form-btn" type="button" onclick="experiments.removeFieldListEntry('{{ field.name }}')">
                Remove
              </button>
            </div>
          {% elif field.type == 'SelectOtherField' %}
            {% set datalist_id = field.id + "-datalist" %}
            {{ field(list=datalist_id, class="form-control") }}
            <datalist id="{{ datalist_id }}">
              {% if data[field.render_kw['data-key']].__class__.__name__ == dict %}
                {% for key, value in data[field.render_kw['data-key']].items() %}
                  <option label="{{ key }}" value="{{ value }}">
                {% endfor %}
              {% elif data[field.render_kw['data-key']].__class__.__name__ == 'list' %}
                {% for value in data[field.render_kw['data-key']] %}
                  <option value="{{ value }}">
                {% endfor %}
              {% endif %}
            </datalist>
          {% endif %}
        </div>
      {% endif %}
    {% endfor %}
  </form>
{% endblock %}