{% extends 'common/base_main.html' %}
{% import 'experiments/macros.html' as macros %}

{% block contenttitle %}
<h2><span style="color: red">CONP Portal</span> | Experiments Search</h2>
{% endblock %}

{% block appcontent %}
<div class="search-dataset-table">
  {% block searchBar %}
  <div class="searchbar d-flex">
      <div class="dropdown d-flex p-2">
          <span class="text-nowrap m-2">Filter By: </span>
         {% for filter_column in ['modalities', 'purpose', 'software'] %}
             <div class="dropdown">
                 <button class="btn btn-outline-secondary dropdown-toggle p-2 mx-1" type="button" id={{ filter_column + "DropdownMenuButton" }} data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                     {{ filter_column }}
                 </button>
                <div class="dropdown-menu" aria-labelledby={{ filter_column + "DropdownMenuButton" }}>
                 {% for option in filters[filter_column]['options'] %}
                  <div class="dropdown-item p-0">
                      <a class="btn btn-light p-1" href="{{ url_for('experiments.search', page=pagination.page, per_page=per_page, sort_key=sort_key, filter_column=filter_column, filter_option=option) }}">{{ option }}</a>
                  </div>
                 {% endfor %}
                </div>
             </div>
         {% endfor %}
      </div>
      <div class="d-flex flex-fill align-items-center">
          <div class="input-group m-2">
              <input class="form-control p-2" type="text" placeholder="Search" aria-label="Search" value="">
              <span class="input-group-append">
                  <span class="input-group-text" id="basic-addon2">
                      <i class="fa fa-search"></i>
                  </span>
              </span>
          </div>
      </div>
  </div>
  {% endblock %}

  {% block dropdowns %}
  <div class="d-flex align-items-center justify-content-between">
    <div class="d-flex p-2 align-items-center">
        {% set firstResultNumber = (pagination.page - 1) * pagination.per_page + 1 %}
        <span>Results {{ firstResultNumber }} - {{ [firstResultNumber + pagination.per_page, pagination.total] | min }}
            displayed of {{ pagination.total }}.</span>
        <div class="d-flex align-items-center ml-1">
            <span>(Maximum results per page</span>
            <span class="dropdown p-2">
                <button class="btn btn-secondary dropdown-toggle p-2" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{ pagination.per_page }}</button>
                <div class="dropdown-menu" style="min-width: 5rem;">
                    {% for option in [5, 10, 15, 20] %}
                        <div class="dropdown-item p-0">
                            <a class="btn btn-light p-1" href="{{ url_for('experiments.search', page=pagination.page, per_page=option) }}">{{ option }}</a>
                        </div>
                    {% endfor %}
                </div>
            </span>)
        </div>
    </div>
    <div class="dropdown d-flex p-2">
        <span class="text-nowrap m-2">Sort By: </span>
        <button class="btn btn-outline-secondary dropdown-toggle p-2" type="button" id="dropdownSortButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{ sort_key }}</button>
        <div class="dropdown-menu dropdown-menu-right" style="min-width: 10rem;">
            {% for option in sort_key_options.keys() %}
                <div class="dropdown-item p-0">
                    <a class="btn btn-light p-1" href="{{ url_for('experiments.search', page=pagination.page, per_page=per_page, sort_key=option) }}">{{ option }}</a>
                </div>
            {% endfor %}
        </div>
    </div>
  </div>
  {% endblock %}

  {% block experimentTable %}
    {% for experiment in pagination.items %}
      {{ macros.renderExperimentCard(experiment) }}
    {% endfor %}
  {% endblock %}

  {% block pageLinks %}
  <div class="search-dataset-footer d-flex align-items-center p-2">
    <div class="btn-group">
        <a class="btn btn-outline-dark" href="{{ url_for('experiments.search') }}">&lt;&lt;</a>
        <a class="btn btn-outline-dark" href="{{ url_for('experiments.search', page=pagination.prev_num) }}">&lt;</a>
        {% for page in pagination.iter_pages(left_edge=0, left_current=2, right_current=5, right_edge=0) %}
            {% if page %}
                {% if page != pagination.page %}
                    <a class="btn btn-outline-dark" href="{{ url_for('experiments.search', page=page) }}">{{ page }}</a>
                {% else %}
                    <a class="btn btn-dark" href="{{ url_for('experiments.search', page=page) }}">{{ page }}</a>
                {% endif %}
            {% endif %}
        {% endfor %}
        <a class="btn btn-outline-dark" href="{{ url_for('experiments.search', page=pagination.next_num) }}">&gt;</a>
        <a class="btn btn-outline-dark" href="{{ url_for('experiments.search', page=pagination.pages) }}">&gt;&gt;</a>
    </div>
  </div>
  {% endblock %}
</div>

{% endblock %}